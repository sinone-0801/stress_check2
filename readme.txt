# PPG指先測定アプリケーション（デバッグ用短時間測定版）

このアプリケーションは、指先の赤色成分からPPG（光電容積脈波）信号を抽出し、心拍間隔（RRI）の予測と交感神経・副交感神経のバランス解析を行うウェブアプリケーションです。

## デバッグ版の特徴

通常版からの主な変更点：

1. **測定時間の短縮**：300秒（5分）→最短30秒から選択可能
2. **信号処理パラメータの最適化**：
   - 最大ウィンドウサイズ: 300→60に縮小
   - 瞬時振幅計算の時間窓: 30→10に縮小
   - 振幅スムージングの窓サイズ: 15→5に縮小
   - 移動平均の窓サイズ: 30→10に縮小
3. **迅速なピーク検出**：
   - ピーク検出ウィンドウサイズを縮小（10→5）
   - 最大PPGサンプル数を縮小（100→60）
   - 最小ピーク間隔のデフォルト値を調整（250ms）
4. **リアルタイム表示の改善**：
   - 測定残り時間の表示
   - 解析更新間隔の短縮（1秒→0.5秒）
   - 少ないデータでも早めに結果を表示
5. **最終結果表示機能の追加**：
   - 測定終了後に結果サマリーを表示
   - LFiA/HFiAの平均値を計算
   - LF/HF比の最終結果を表示
   - ストレス状態の判定と色分け表示
   - 最終的な2DiA散布図を表示（全データポイント + 平均値）

## 使用方法

1. ファイルを配置：
   - `signal-processing-debug.js` 
   - `camera-processor-debug.js` 
   - `app-result-display.js`
   - `index-with-results.html`

2. ブラウザで `index-with-results.html` を開く

3. 測定時間を選択（30秒/60秒/120秒）

4. 「測定開始」ボタンを押す

5. 測定終了後、自動的に結果サマリーが表示される

## 測定結果の見方

測定終了後に表示される結果セクションには以下の情報が含まれます：

1. **平均心拍数**: 測定時間内の平均BPM
2. **LF/HF比**: 自律神経バランスの指標
3. **LFiA (低周波瞬時振幅)**: 交感神経活動の指標
4. **HFiA (高周波瞬時振幅)**: 副交感神経活動の指標
5. **ストレス状態の判定**: 4つの状態に分類
   - 安静状態 (Rest): LF低・HF低
   - 深いリラックス状態 (Deep Relaxation): LF低・HF高
   - 軽い身体的ストレス (Light Physical Stress): LF高・HF低
   - 軽い精神的ストレス (Light Mental Stress): LF高・HF高
6. **最終2DiA散布図**: 測定中の全データポイントと平均値を表示

## 注意点

- デバッグ版は短時間で結果を得るために最適化されているため、長時間の解析に比べて精度が低下する可能性があります
- 少ないデータから計算するため、初期の値は安定しないことがあります
- 検出したピーク数が少ない場合は結果が不安定になる可能性があります
- 異常値や無効なデータポイントは最終結果の計算から除外されます

## 技術詳細

デバッグ版では以下の技術的調整を行っています：

- **信号処理の閾値調整**：少ないデータサンプルでも処理できるよう、最小データ量の閾値を下げています（30→15サンプル）
- **フィルタ処理の最適化**：短いデータでも効果的なフィルタリングができるよう調整しています
- **振幅計算の調整**：外れ値の影響を減らすため、中央80%のデータのみを使用するよう変更しています（元は60%）
- **自動停止機能**：設定した時間が経過すると自動的に測定を停止します
- **データ保存機能**：測定中のデータを保存し、測定後の最終結果計算に使用します
- **結果表示の拡充**：平均値の計算と最終的な散布図にその平均値を強調表示しています

このデバッグ版を使用することで、アプリケーションの機能確認や初期設定の調整を迅速に行うことができます。また、測定結果の傾向を短時間で確認できるため、デバッグ作業が効率化されます。